<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora de Efectividad - Facebook Ads</title>
<style>
:root{--bg:#0f1724;--card:#0b1220;--accent:#ef4444;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:linear-gradient(180deg,#071029 0%, #081426 100%);color:#e6eef8}
.wrap{max-width:980px;margin:28px auto;padding:20px}
header{display:flex;align-items:center;gap:16px}
h1{margin:0;font-size:20px}
p.lead{margin:0;color:var(--muted);font-size:13px}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:18px}
label{font-size:12px;color:var(--muted)}
input[type=number],input[type=text],input[type=date]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit}
.full{grid-column:span 3}
.actions{display:flex;gap:8px;margin-top:12px}
button{background:var(--accent);color:white;padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06)}
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;margin-top:18px}
.results{display:flex;gap:12px;flex-wrap:wrap}
.tile{flex:1 1 140px;background:rgba(255,255,255,0.02);padding:12px;border-radius:8px;position:relative}
.tile b{display:block;font-size:18px}
.tile .tooltip{font-size:11px;color:var(--muted);position:absolute;bottom:4px;right:4px}
.rec{margin-top:10px;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--muted)}
.alert{padding:12px;border-radius:8px;margin-top:12px}
.alert.loss{background:#3b0f0f;color:#ffd0d0}
.alert.win{background:#0f2f17;color:#c8ffd6}
.chart-container{margin-top:20px}
.date-selector{display:flex;gap:8px;margin-top:12px;align-items:center}
.quick-buttons button{padding:5px 10px;font-size:12px}
@media(max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}.full{grid-column:span 2}}
@media(max-width:600px){.grid{grid-template-columns:1fr}.full{grid-column:span 1}}
</style>
</head>
<body>
<div class="wrap">
<header>
<div>
<h1>Calculadora de Efectividad - Facebook Ads</h1>
<p class="lead">Introduce los datos de tu campa√±a y obt√©n CPA, ROAS, rentabilidad, gr√°ficas y recomendaciones autom√°ticas.</p>
</div>
</header>

<form id="form" onsubmit="return false;">
<div class="grid">
<!-- Inputs existentes -->
<div>
<label>Impresiones</label>
<input id="impressions" type="number" min="0" step="1" placeholder="Ej: 50000" />
</div>
<div>
<label>CTR (%)</label>
<input id="ctr" type="number" min="0" step="0.01" placeholder="Tasa de clics (ej: 1.5)" />
</div>
<div>
<label>CPC (por clic)</label>
<input id="cpc" type="number" min="0" step="0.01" placeholder="Costo por clic" />
</div>
<div>
<label>CTA (clics en CTA)</label>
<input id="cta" type="number" min="0" step="1" placeholder="N√∫mero de clics a CTA" />
</div>
<div>
<label>Conversaciones iniciadas (conversiones)</label>
<input id="conversions" type="number" min="0" step="1" placeholder="Conversaciones iniciadas" />
</div>
<div>
<label>Importe gastado (COP)</label>
<input id="spent" type="number" min="0" step="0.01" placeholder="Gasto total" />
</div>
<div>
<label>Precio de bodega (por unidad)</label>
<input id="cost_price" type="number" min="0" step="0.01" placeholder="Costo por unidad" />
</div>
<div>
<label>Precio de venta (por unidad)</label>
<input id="sale_price" type="number" min="0" step="0.01" placeholder="Precio venta por unidad" />
</div>
<div>
<label>Costo aproximado de env√≠o por unidad</label>
<input id="shipping" type="number" min="0" step="0.01" placeholder="Costo env√≠o" />
</div>
<div>
<label>Cantidad de unidades vendidas</label>
<input id="units_sold" type="number" min="0" step="1" placeholder="Unidades vendidas" />
</div>
<div class="full">
<label>ROAS (si lo conoces; opcional) ‚Äî si lo dejas vac√≠o se calcular√°</label>
<input id="roas_input" type="number" min="0" step="0.01" placeholder="Ej: 1.8" />
</div>
</div>

<!-- Selector de fechas -->
<div class="date-selector full">
<label>Desde:</label><input id="fechaInicio" type="date" />
<label>Hasta:</label><input id="fechaFin" type="date" />
<div class="quick-buttons">
<button type="button" onclick="setDateRange('hoy')">Hoy</button>
<button type="button" onclick="setDateRange('ayer')">Ayer</button>
<button type="button" onclick="setDateRange('7dias')">√öltimos 7 d√≠as</button>
</div>
</div>

<div class="actions">
<button id="calc">Calcular</button>
<button id="reset" type="button" class="secondary">Limpiar</button>
<button id="download" type="button" class="secondary">üì• Descargar Reporte</button>
</div>
</form>

<div class="panel">
<div class="results" id="results">
<div class="tile">CPA (Costo por Adquisici√≥n) <span class="tooltip" title="Costo promedio para obtener una conversi√≥n">(?)</span><b id="out_cpa">-</b></div>
<div class="tile">ROAS <span class="tooltip" title="Retorno de inversi√≥n publicitaria">(?)</span><b id="out_roas">-</b></div>
<div class="tile">Ingresos <span class="tooltip" title="Total estimado de ingresos">(?)</span><b id="out_revenue">-</b></div>
<div class="tile">Beneficio Neto Aproximado <span class="tooltip" title="Ingresos menos costos">(?)</span><b id="out_profit">-</b></div>
<div class="tile">Costo por resultado (Conversaci√≥n) <span class="tooltip" title="Costo por conversi√≥n">(?)</span><b id="out_cost_per_result">-</b></div>
<div class="tile">Conversion Rate (%) <span class="tooltip" title="Tasa de conversi√≥n">(?)</span><b id="out_conv_rate">-</b></div>
</div>
<div id="statusAlert"></div>

<div class="chart-container">
<canvas id="chart"></canvas>
</div>

<div class="rec" id="recommendations">
<strong>Recomendaciones autom√°ticas</strong>
<div id="rec_list" style="margin-top:8px;color:var(--muted)">Aqu√≠ aparecer√°n recomendaciones basadas en los datos ingresados.</div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const $ = id => document.getElementById(id);
let chart = null;

function fmt(n){return (Math.round((n + Number.EPSILON)*100)/100).toLocaleString('es-CO')}

function setDateRange(option){
  const today = new Date();
  if(option==='hoy'){
    $('fechaInicio').valueAsDate = today;
    $('fechaFin').valueAsDate = today;
  } else if(option==='ayer'){
    const ayer = new Date(today); ayer.setDate(today.getDate()-1);
    $('fechaInicio').valueAsDate = ayer;
    $('fechaFin').valueAsDate = ayer;
  } else if(option==='7dias'){
    const desde = new Date(today); desde.setDate(today.getDate()-6);
    $('fechaInicio').valueAsDate = desde;
    $('fechaFin').valueAsDate = today;
  }
}

function calculate(){
  const impressions = Number($('impressions').value) || 0;
  const ctr = Number($('ctr').value) || (impressions>0? ((Number($('cta').value)||0)/impressions*100):0);
  const cpc = Number($('cpc').value) || 0;
  const cta = Number($('cta').value) || 0;
  const conversions = Number($('conversions').value) || 0; 
  const spent = Number($('spent').value) || 0;
  const cost_price = Number($('cost_price').value) || 0;
  const sale_price = Number($('sale_price').value) || 0;
  const shipping = Number($('shipping').value) || 0;
  const units = Number($('units_sold').value) || 0;
  const roas_input = Number($('roas_input').value) || null;

  const cpa = conversions>0 ? (spent / conversions) : NaN;
  const revenue = units * sale_price;
  const gross_margin_per_unit = sale_price - cost_price - shipping;
  const total_gross_profit = gross_margin_per_unit * units;
  const net_profit = total_gross_profit - spent; 
  const roas = roas_input ? roas_input : (spent>0? (revenue / spent) : NaN);
  const costPerResult = cpa;
  const convRate = cta>0? (conversions/cta*100) : (cta===0? 0 : NaN);

  $('out_cpa').innerText = isFinite(cpa)? ('$ ' + fmt(cpa)) : '-';
  $('out_roas').innerText = isFinite(roas)? (fmt(roas) + 'x') : '-';
  $('out_revenue').innerText = '$ ' + fmt(revenue);
  $('out_profit').innerText = (isFinite(net_profit)? ('$ ' + fmt(net_profit)) : '-') ;
  $('out_cost_per_result').innerText = isFinite(costPerResult)? ('$ ' + fmt(costPerResult)) : '-';
  $('out_conv_rate').innerText = isFinite(convRate)? (fmt(convRate) + ' %') : '-';

  const statusDiv = $('statusAlert'); statusDiv.innerHTML = '';
  const alert = document.createElement('div'); alert.className = 'alert';
  if(!isFinite(net_profit)){
    alert.className = 'alert win';
    alert.innerText = 'Datos incompletos para evaluar rentabilidad.';
  } else if(net_profit < 0){
    alert.className = 'alert loss';
    alert.innerHTML = 'Campa√±a generando <strong>P√âRDIDAS</strong>: $ ' + fmt(Math.abs(net_profit));
  } else {
    alert.className = 'alert win';
    alert.innerHTML = 'Campa√±a rentable: beneficio $ ' + fmt(net_profit);
  }
  statusDiv.appendChild(alert);

  const recs = generateRecommendations({impressions, ctr, cpc, cta, conversions, spent, revenue, roas, costPerResult, convRate, net_profit, gross_margin_per_unit, sale_price});
  const recList = $('rec_list'); recList.innerHTML = '';
  recs.forEach(r=>{const d=document.createElement('div');d.innerText='‚Ä¢ '+r;recList.appendChild(d)});

  renderChart({spent, revenue, net_profit, cpa: cpa, roas});
}

function generateRecommendations(data){
  const rec=[];
  const {ctr, cpc, costPerResult, convRate, net_profit, gross_margin_per_unit, sale_price} = data;
  if(ctr>0){
    if(ctr < 0.5) rec.push('CTR bajo: prueba nuevas creatividades.');
    else if(ctr < 1.2) rec.push('CTR moderado: testea variaciones A/B.');
    else rec.push('CTR bueno: considera escalar.');
  }
  if(cpc>0){
    if(cpc > gross_margin_per_unit*0.6) rec.push('CPC alto: optimiza pujas.');
    else rec.push('CPC aceptable.');
  }
  if(costPerResult > sale_price) rec.push('CPA mayor que precio de venta: revisar estrategia.');
  if(convRate < 5) rec.push('Conversi√≥n baja: optimiza landing/chat.');
  if(net_profit < 0) rec.push('Campa√±a con p√©rdidas: ajustar costos o precio.');
  else rec.push('Beneficio positivo: considerar reinversi√≥n.');
  return rec;
}

function renderChart(data){
  const labels = ['Gasto','Ingresos','Beneficio','CPA','ROAS'];
  const ds = [data.spent||0,data.revenue||0,data.net_profit||0,(isFinite(data.cpa)? data.cpa:0),(isFinite(data.roas)? data.roas:0)];
  if(chart) chart.destroy();
  const ctx = document.getElementById('chart').getContext('2d');
  chart = new Chart(ctx,{type:'bar',data:{labels,datasets:[{label:'Valores',data:ds}]},options:{responsive:true,scales:{y:{beginAtZero:true}}}});
}

$('calc').addEventListener('click',calculate);
$('reset').addEventListener('click',()=>{
  document.getElementById('form').reset();
  document.getElementById('results').querySelectorAll('b').forEach(b=>b.innerText='-');
  document.getElementById('rec_list').innerText='Aqu√≠ aparecer√°n recomendaciones basadas en los datos ingresados.';
  if(chart) chart.destroy();
  document.getElementById('statusAlert').innerHTML='';
});

$('ctr').addEventListener('input',()=>{
  const imp = Number($('impressions').value)||0;
  const ctr = Number($('ctr').value)||0;
  if(imp && ctr) $('cta').placeholder = 'Estimado: '+Math.round(imp*ctr/100)+' clics';
});
</script>
</body>
</html>
