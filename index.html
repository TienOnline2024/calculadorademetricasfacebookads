<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora Facebook Ads — COP</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--good:#10b981;--bad:#ef4444;--warn:#f59e0b}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#071124 0%, #081826 100%);color:#e6eef6}
    .wrap{max-width:1100px;margin:28px auto;padding:24px}
    header{display:flex;align-items:center;gap:16px}
    header h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    .row{display:flex;gap:12px;align-items:center}
    input[type=text], input[type=number], select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .field{margin-bottom:12px}
    .small{font-size:13px;color:var(--muted)}
    .results{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .result{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
    .big{font-size:20px;font-weight:700}
    .muted{color:var(--muted)}
    .btn{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;color:#052021;font-weight:600;cursor:pointer}
    .toggle{display:flex;gap:8px}
    .alert{padding:12px;border-radius:10px;margin-bottom:12px}
    .alert.good{background:linear-gradient(90deg, rgba(16,185,129,0.12), rgba(16,185,129,0.04));border:1px solid rgba(16,185,129,0.14);color:var(--good)}
    .alert.bad{background:linear-gradient(90deg, rgba(239,68,68,0.12), rgba(239,68,68,0.04));border:1px solid rgba(239,68,68,0.14);color:var(--bad)}
    .alert.warn{background:linear-gradient(90deg, rgba(245,158,11,0.12), rgba(245,158,11,0.04));border:1px solid rgba(245,158,11,0.14);color:var(--warn)}
    small.note{display:block;color:var(--muted);margin-top:6px}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    @media(max-width:980px){.grid{grid-template-columns:1fr;}.results{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <svg width="36"height="36"viewBox="0 0 24 24"fill="none"xmlns="http://www.w3.org/2000/svg"><rect width="24"height="24"rx="6"fill="#052021"/><path d="M6 12h12M6 7h12M6 17h12" stroke="#06b6d4" stroke-width="1.2" stroke-linecap="round"/></svg>
      <div>
        <h1>Calculadora Facebook Ads — COP</h1>
        <div class="small">Calcula ROAS, CAC, margen y salud de campaña. Formato en pesos colombianos.</div>
      </div>
    </header>

    <div class="grid">
      <!-- Left: inputs -->
      <div class="card">
        <div id="alertArea"></div>

        <div class="field">
          <label>Modo</label>
          <select id="mode">
            <option value="dropship">Dropshipping (omite costos de bodega)</option>
            <option value="store">Tienda propia (considera inventario y bodega)</option>
          </select>
        </div>

        <div class="field">
          <label>Rango de fechas</label>
          <select id="range">
            <option value="today">Hoy</option>
            <option value="yesterday">Ayer</option>
            <option value="7">Últimos 7 días</option>
            <option value="14">Últimos 14 días</option>
          </select>
          <small class="note">La calculadora normaliza promedios según el rango seleccionado.</small>
        </div>

        <div class="field">
          <label>Cantidad de productos vendidos (total en rango)</label>
          <input id="qtySold" type="text" inputmode="numeric" placeholder="ej. 120" />
        </div>

        <div style="display:flex;gap:12px">
          <div style="flex:1" class="field">
            <label>Precio de venta por unidad</label>
            <input id="price" type="text" inputmode="numeric" placeholder="$139.900" />
          </div>

          <div style="flex:1" class="field">
            <label>Precio de bodega por unidad (si aplica)</label>
            <input id="cost" type="text" inputmode="numeric" placeholder="$80.000" />
          </div>
        </div>

        <div class="field">
          <label>Costos adicionales por unidad (envío, empaque, otros)</label>
          <input id="extraCost" type="text" inputmode="numeric" placeholder="$8.000" />
          <small class="note">En dropshipping puede ser el costo del proveedor + envío.</small>
        </div>

        <div class="field">
          <label>Gasto total en anuncios (en el rango)</label>
          <input id="adSpend" type="text" inputmode="numeric" placeholder="$450.000" />
        </div>

        <div class="field">
          <label>Conversiones (clientes nuevos / ventas atribuibles)</label>
          <input id="conversions" type="text" inputmode="numeric" placeholder="ej. 18" />
        </div>

        <div class="field">
          <label>Número de SKUs / Promedio de precio por orden (opcional)</label>
          <input id="aov" type="text" inputmode="numeric" placeholder="$200.000 — deja vacío para usar precio de venta" />
          <small class="note">Si vendes más de 1 producto por pedido, pon el AOV (valor promedio del pedido).</small>
        </div>

        <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
          <button class="btn" id="calcBtn">Calcular</button>
          <button class="btn" id="resetBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.05);color:inherit">Limpiar</button>
        </div>

        <footer>
          <div>Consejo: usa el modo <strong>dropshipping</strong> si no sostienes inventario. Para tienda propia incluye precio de bodega y costos fijos en extraCost si aplica.</div>
        </footer>
      </div>

      <!-- Right: results -->
      <div class="card">
        <h3 style="margin-top:0">Resultados</h3>
        <div class="results" id="resultsGrid">
          <div class="result">
            <div class="muted">Ingresos</div>
            <div id="revenue" class="big">$0</div>
            <small class="note">Total en el rango seleccionado.</small>
          </div>

          <div class="result">
            <div class="muted">Costo total (productos + extra)</div>
            <div id="totalCost" class="big">$0</div>
            <small class="note">Incluye costo de bodega/compra + envíos/otros.</small>
          </div>

          <div class="result">
            <div class="muted">Beneficio bruto</div>
            <div id="grossProfit" class="big">$0</div>
            <small class="note">Ingresos - (costos + gasto anuncios).</small>
          </div>

          <div class="result">
            <div class="muted">Margen bruto (%)</div>
            <div id="marginPct" class="big">0%</div>
            <small class="note">Beneficio bruto ÷ ingresos.</small>
          </div>

          <div class="result">
            <div class="muted">ROAS (Return on Ad Spend)</div>
            <div id="roas" class="big">0</div>
            <small class="note">Ingresos ÷ Gasto en anuncios.</small>
          </div>

          <div class="result">
            <div class="muted">CAC — Costo por adquisición</div>
            <div id="cac" class="big">$0</div>
            <small class="note">Gasto anuncios ÷ conversiones.</small>
          </div>

        </div>

        <div style="margin-top:12px">
          <h4 style="margin:6px 0">Promedios por día</h4>
          <div class="results">
            <div class="result"><div class="muted">Ventas / día</div><div id="perDaySales" class="big">0</div></div>
            <div class="result"><div class="muted">Gasto Ads / día</div><div id="adPerDay" class="big">$0</div></div>
            <div class="result"><div class="muted">Ingreso / día</div><div id="revPerDay" class="big">$0</div></div>
            <div class="result"><div class="muted">Beneficio / día</div><div id="profitPerDay" class="big">$0</div></div>
          </div>
        </div>

        <div style="margin-top:12px" id="recommendationsArea"></div>

      </div>
    </div>
  </div>

  <script>
    // Helper: parse inputs tolerating $ and separators
    function parseCOP(value){
      if(value === undefined || value === null) return 0;
      const v = String(value).replace(/\s+/g,'').replace(/\$/g,'').replace(/₱/g,'').replace(/,/g,'').replace(/\./g,'');
      // If user used a comma for decimals (rare for COP) handle
      if(v === '') return 0;
      const num = parseFloat(v);
      return isNaN(num) ? 0 : Math.round(num);
    }

    // Format number to $139.900 (colombian style)
    function fmtCOP(n){
      const sign = n < 0 ? '-' : '';
      const v = Math.abs(Math.round(n));
      return sign + '$' + v.toLocaleString('es-CO');
    }

    function safeDivide(a,b){return (b === 0) ? 0 : (a/b);
    }

    function daysInRange(range){
      if(range === 'today' || range === 'yesterday') return 1;
      const n = parseInt(range,10);
      return (isNaN(n) || n<=0) ? 1 : n;
    }

    function showAlert(type, html){
      const area = document.getElementById('alertArea');
      area.innerHTML = `<div class="alert ${type}">${html}</div>`;
    }
    function clearAlert(){document.getElementById('alertArea').innerHTML='';}

    function showRecommendations(lines,type){
      const out = document.getElementById('recommendationsArea');
      const cls = type==='good' ? 'good' : (type==='warn' ? 'warn' : 'bad');
      out.innerHTML = `<div class="alert ${cls}"><strong>Recomendaciones</strong><ul style="margin:8px 0 0 18px">${lines.map(l=>`<li>${l}</li>`).join('')}</ul></div>`;
    }

    document.getElementById('calcBtn').addEventListener('click', compute);
    document.getElementById('resetBtn').addEventListener('click', ()=>{document.querySelectorAll('input[type=text]').forEach(i=>i.value=''); clearDisplay(); clearAlert(); document.getElementById('recommendationsArea').innerHTML='';});

    function clearDisplay(){
      ['revenue','totalCost','grossProfit','marginPct','roas','cac','perDaySales','adPerDay','revPerDay','profitPerDay'].forEach(id=>document.getElementById(id).innerText = id==='marginPct' ? '0%': (id==='perDaySales'?'0':'$0'));
      document.getElementById('roas').innerText='0';
    }

    function compute(){
      // Read inputs
      const mode = document.getElementById('mode').value;
      const range = document.getElementById('range').value;
      const days = daysInRange(range);

      const qtySold = parseCOP(document.getElementById('qtySold').value);
      const price = parseCOP(document.getElementById('price').value);
      const cost = parseCOP(document.getElementById('cost').value);
      const extraCost = parseCOP(document.getElementById('extraCost').value);
      const adSpend = parseCOP(document.getElementById('adSpend').value);
      const conv = parseCOP(document.getElementById('conversions').value);
      const aov = parseCOP(document.getElementById('aov').value);

      // Derived
      const revenue = (aov>0) ? (aov * conv) : (qtySold * price);

      // For dropship: assume cost includes supplier and shipping; if user left cost 0, we'll estimate cost as 60% of price (configurable)
      let unitCost = cost;
      if(mode === 'dropship'){
        if(unitCost <= 0){ unitCost = Math.round(price * 0.6); } // default estimate
      }

      const productCostTotal = qtySold * unitCost;
      const extraTotal = qtySold * extraCost;
      const totalCost = productCostTotal + extraTotal;

      // Gross profit = revenue - totalCost - adSpend
      const grossProfit = revenue - totalCost - adSpend;
      const marginPct = revenue === 0 ? 0 : Math.round((grossProfit / revenue) * 10000)/100; // two decimals

      const roas = adSpend === 0 ? (revenue>0 ? Infinity : 0) : (revenue / adSpend);
      const cac = conv === 0 ? 0 : Math.round(adSpend / conv);

      // Per-day
      const perDaySales = Math.round(qtySold / days * 100)/100;
      const adPerDay = Math.round(adSpend / days);
      const revPerDay = Math.round(revenue / days);
      const profitPerDay = Math.round(grossProfit / days);

      // Show results
      document.getElementById('revenue').innerText = fmtCOP(revenue);
      document.getElementById('totalCost').innerText = fmtCOP(totalCost);
      document.getElementById('grossProfit').innerText = fmtCOP(grossProfit);
      document.getElementById('marginPct').innerText = (isFinite(marginPct)? (marginPct.toFixed(2)+'%') : '0%');
      document.getElementById('roas').innerText = (roas === Infinity) ? '—' : (Math.round(roas*100)/100).toString();
      document.getElementById('cac').innerText = fmtCOP(cac);

      document.getElementById('perDaySales').innerText = perDaySales.toLocaleString('es-CO');
      document.getElementById('adPerDay').innerText = fmtCOP(adPerDay);
      document.getElementById('revPerDay').innerText = fmtCOP(revPerDay);
      document.getElementById('profitPerDay').innerText = fmtCOP(profitPerDay);

      // Health logic & recommendations
      // Thresholds (editable):
      // ROAS: <1 bad, 1-1.5 warn, >1.5 ok; Margin: <0 loss, 0-15% warn, >15% good
      const recs = [];
      let healthType = 'good';

      if(revenue <= 0){
        showAlert('bad', 'No hay ingresos registrados para el rango seleccionado. Verifica cantidad de ventas o precios.');
        healthType='bad';
        recs.push('Verifica que el número de ventas y el precio de venta estén correctos.');
      }

      if(!isFinite(roas) || roas === 0){
        recs.push('Gasto en anuncios es 0 o no hay ingresos atribuidos. Si estás haciendo pruebas, añade gasto real para medir ROAS.');
      }

      if(roas !== Infinity && roas < 1){
        // terrible
        showAlert('bad', `ROAS bajo (${Math.round(roas*100)/100}). Estás gastando más en anuncios de lo que recuperas.`);
        healthType='bad';
        recs.push('Reducir CPA: optimiza audiencias, detener anuncios con CTR bajo, mejorar creativos y landing page.');
        recs.push('Revisa costos: negocia con proveedores o sube el precio si el mercado lo permite.');
      } else if(roas !== Infinity && roas < 1.5){
        showAlert('warn', `ROAS moderado (${Math.round(roas*100)/100}). Posible riesgo.`);
        healthType='warn';
        recs.push('Mejorar la calidad del tráfico: optimiza segmentación y pruebas A/B en anuncios.');
        recs.push('Reduce costos por envío o agrega upsells para aumentar AOV.');
      } else {
        // good roas
        if(grossProfit < 0){
          showAlert('bad', `Ingresos OK pero hay pérdida neta: beneficio bruto negativo ${fmtCOP(grossProfit)}.`);
          healthType='bad';
          recs.push('Aumenta precio o reduce costos variables; revisa ad targeting para ventas con mayor AOV.');
        } else {
          showAlert('good', `Salud positiva — ROAS ${ (roas===Infinity?'—':(Math.round(roas*100)/100)) } y margen ${ (isFinite(marginPct)?marginPct.toFixed(2)+'%':'0%') }`);
          healthType='good';
          recs.push('Escala lo que funciona: duplica creativos con mejor rendimiento y prueba audiencias similares (lookalike).');
          recs.push('Considera invertir más en canales con buen ROAS y añade ofertas/paquetes para mejorar AOV.');
        }
      }

      // Additional checks for dropshipping vs store
      if(mode === 'dropship'){
        if(unitCost > price * 0.8){
          recs.push('En dropshipping el costo por unidad es muy alto en relación al precio de venta; negocia con proveedor o aumenta precio.');
        }
      } else {
        // store
        if(extraCost > 0 && (extraCost + unitCost) > price * 0.85){
          recs.push('Costos logísticos + costo de bodega están consumiendo la mayoría del precio; optimiza empaques o tarifas de envío.');
        }
      }

      // CAC sanity check
      if(conv > 0 && (adSpend/conv) > price){
        recs.push('El CAC es mayor que el precio medio del pedido: o reduces CAC o aumentas AOV.');
      }

      showRecommendations(recs, healthType);
    }

    // Format inputs as user types (adds thousand separators)
    function formatInputAsCOP(el){
      const start = el.selectionStart;
      let raw = el.value.replace(/\D/g,'');
      if(raw === ''){ el.value=''; return; }
      raw = parseInt(raw,10).toString();
      el.value = '$' + Number(raw).toLocaleString('es-CO');
      // naive caret restore
    }

    ['qtySold','price','cost','extraCost','adSpend','conversions','aov'].forEach(id=>{
      const el = document.getElementById(id);
      el.addEventListener('input', (e)=>{
        // allow only digits and format
        const t = e.target;
        const clean = t.value.replace(/[^0-9]/g,'');
        if(clean === ''){ t.value = ''; return; }
        t.value = '$'+Number(clean).toLocaleString('es-CO');
      });
    });

    // initial
    clearDisplay();
  </script>
</body>
</html>

